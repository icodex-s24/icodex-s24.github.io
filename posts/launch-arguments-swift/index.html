<!doctype html><html lang="en" data-mode="dark"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7" /><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e" /><meta name="apple-mobile-web-app-capable" content="yes" /><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" /><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" /><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Launch arguments in Swift" /><meta property="og:locale" content="en" /><meta name="description" content="Launch arguments are probably most commonly used as input to command line tools." /><meta property="og:description" content="Launch arguments are probably most commonly used as input to command line tools." /><link rel="canonical" href="/posts/launch-arguments-swift/" /><meta property="og:url" content="/posts/launch-arguments-swift/" /><meta property="og:site_name" content="iCodeX’s blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2018-05-20T18:07:00-04:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Launch arguments in Swift" /><meta name="twitter:site" content="@icodex-s24" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2018-05-20T18:07:00-04:00","datePublished":"2018-05-20T18:07:00-04:00","description":"Launch arguments are probably most commonly used as input to command line tools.","headline":"Launch arguments in Swift","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/launch-arguments-swift/"},"url":"/posts/launch-arguments-swift/"}</script><title>Launch arguments in Swift | iCodeX's blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="iCodeX's blog"><meta name="application-name" content="iCodeX's blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css" /><link rel="stylesheet" href="/assets/lib/fonts/main.css" /><link rel="stylesheet" href="/assets/lib/fontawesome-free/css/all.min.css" /><link rel="stylesheet" href="/assets/lib/tocbot/tocbot.min.css" /><link rel="stylesheet" href="/assets/lib/loading-attribute-polyfill/loading-attribute-polyfill.min.css" /><link rel="stylesheet" href="/assets/lib/glightbox/glightbox.min.css" /><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/img/logo.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a><h1 class="site-title"> <a href="/">iCodeX's blog</a></h1><p class="site-subtitle fst-italic mb-0">Code. Learn. Write. Repeat</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <a href="https://github.com/icodex-s24" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/icodex-s24" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fa-brands fa-x-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['j.doit926','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Launch arguments in Swift</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1"><header><h1 data-toc-skip>Launch arguments in Swift</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1526854020" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > May 20, 2018 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/icodex-s24">icodex-s24</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="2169 words" > <em>12 min</em> read</span></div></div></div></header><div class="content"><p>Launch arguments are probably most commonly used as input to command line tools.</p><p>While Swift can be a great language for creating command line tools, let’s take a look at how we can also use the power of launch arguments when working on, debugging, and testing an iOS app.</p><h2 id="parsing"><span class="me-2">Parsing</span><a href="#parsing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Swift provides two built-in ways to parse launch arguments. The first one is through the <code class="language-plaintext highlighter-rouge">CommandLine</code> API, which enables easy access to information passed when launching the app (even on platforms like iOS that don’t ship with a terminal). Using <code class="language-plaintext highlighter-rouge">CommandLine.arguments</code> we get an array of strings representing each argument, which we here use to determine whether a new implementation of a <code class="language-plaintext highlighter-rouge">ProfileViewController</code> should be used:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="kd">func</span> <span class="nf">makeProfileViewController</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">UIViewController</span> <span class="p">{</span>
    <span class="k">if</span> <span class="kt">CommandLine</span><span class="o">.</span><span class="n">arguments</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"-new-profile"</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// If the "-new-profile" arguments was passed, then return</span>
        <span class="c1">// an instance of the new implementation.</span>
        <span class="k">return</span> <span class="kt">ProfileViewController</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="c1">// Fall back to the old implementation, which is what we</span>
    <span class="c1">// still use in production.</span>
    <span class="k">return</span> <span class="kt">ProfileLegacyViewController</span><span class="p">()</span>
<span class="p">}</span>

</pre></table></code></div></div><p>While <code class="language-plaintext highlighter-rouge">CommandLine</code> provides a simple way to get access to the “raw” arguments, it doesn’t actually provide any sophisticated parsing capabilities. To gain access to a bit more powerful features, we can actually use <code class="language-plaintext highlighter-rouge">UserDefaults</code> to parse launch arguments.</p><p>The fact that <code class="language-plaintext highlighter-rouge">UserDefaults</code> contains all arguments passed on the command line - and can do basic conversion to types like <code class="language-plaintext highlighter-rouge">Bool</code>, <code class="language-plaintext highlighter-rouge">Int</code> and <code class="language-plaintext highlighter-rouge">Double</code> - is a bit of a hidden gem. Here we’re using that feature to enable us to override how many articles that should be loaded when performing a network request:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="kd">func</span> <span class="nf">loadArticle</span><span class="p">(</span><span class="n">then</span> <span class="nv">handler</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Result</span><span class="o">&lt;</span><span class="p">[</span><span class="kt">Article</span><span class="p">]</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// The UserDefaults API automatically parses types of like integers</span>
    <span class="c1">// doubles from strings passed as launch arguments. In this </span>
    <span class="c1">// case we'll treat 0 as "no limit".</span>
    <span class="k">let</span> <span class="nv">limit</span> <span class="o">=</span> <span class="kt">UserDefaults</span><span class="o">.</span><span class="n">standard</span><span class="o">.</span><span class="nf">integer</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="s">"article-limit"</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">endpoint</span> <span class="o">=</span> <span class="kt">Endpoint</span><span class="o">.</span><span class="nf">articleList</span><span class="p">(</span><span class="nv">limit</span><span class="p">:</span> <span class="n">limit</span><span class="p">)</span>

    <span class="n">dataLoader</span><span class="o">.</span><span class="nf">loadData</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">endpoint</span><span class="p">)</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
        <span class="nf">handler</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="nf">decoded</span><span class="p">())</span>
    <span class="p">}</span>
<span class="p">}</span>

</pre></table></code></div></div><h2 id="passing"><span class="me-2">Passing</span><a href="#passing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Now that we have ways to parse command line arguments in an iOS app, we also need a way to pass them.</p><p>When running and debugging, this is done through Xcode, by adding any arguments that we want to pass to our app’s scheme. An easy way to access this option in Xcode is press ⌘⌥R, selecting “Arguments” and adding our arguments under “Arguments Passed On Launch”.</p><p>So what can launch arguments be useful for? Let’s take a look at three use cases - debugging, working on a new feature and UI testing.</p><h2 id="debug-actions"><span class="me-2">Debug actions</span><a href="#debug-actions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Launch arguments can provide a simple and quick way to perform common actions when debugging an app.</p><p>For example, let’s say that we’re working on an app that performs a large number of network request, and that we’ve had reports from users that the app performs poorly when used on slow networks.</p><p>To debug this problem, we might want to add artificial delays to all network requests, so that we can observe how our app behaves under this type of conditions. While iOS provides the Link conditioner tool, which is an excellent option for on-device debugging, when initially working on a fix we might want quicker iteration times by using the simulator.</p><p>To make that happen, we can use a launch arguments to add delays to all network requests, like this:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre>
<span class="kd">class</span> <span class="kt">DataLoader</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">session</span><span class="p">:</span> <span class="kt">URLSession</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">userDefaults</span><span class="p">:</span> <span class="kt">UserDefaults</span>

    <span class="kd">func</span> <span class="nf">loadData</span><span class="p">(</span><span class="n">from</span> <span class="nv">endpoint</span><span class="p">:</span> <span class="kt">Endpoint</span><span class="p">,</span>
                 <span class="n">then</span> <span class="nv">handler</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Result</span><span class="o">&lt;</span><span class="kt">Data</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">url</span>
        <span class="k">let</span> <span class="nv">task</span> <span class="o">=</span> <span class="nf">makeTask</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="nv">handler</span><span class="p">:</span> <span class="n">handler</span><span class="p">)</span>

        <span class="c1">// If the app is running in debug mode, add a delay</span>
        <span class="c1">// according to the "network-delay" launch argument</span>
        <span class="cp">#if DEBUG</span>
        <span class="k">let</span> <span class="nv">delay</span> <span class="o">=</span> <span class="n">userDefaults</span><span class="o">.</span><span class="nf">double</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="s">"network-delay"</span><span class="p">)</span>
        <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="nf">asyncAfter</span><span class="p">(</span><span class="nv">deadline</span><span class="p">:</span> <span class="o">.</span><span class="nf">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">delay</span><span class="p">,</span>
                                    <span class="nv">execute</span><span class="p">:</span> <span class="n">task</span><span class="o">.</span><span class="n">resume</span><span class="p">)</span>
        <span class="cp">#else</span>
        <span class="n">task</span><span class="o">.</span><span class="nf">resume</span><span class="p">()</span>
        <span class="cp">#endif</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Important to note above is that we wrap our delaying code in a <code class="language-plaintext highlighter-rouge">#if DEBUG</code> compiler condition, to prevent this code from accidentally shipped to the App Store. That way, our debug code won’t even be compiled when doing a release build.</p><p>Similarly, we can add launch arguments to control other types of debug actions in our app - for example;</p><p>navigating to a given screen when the app launches, whether an in-app purchase has been unlocked, or simulating data from things like the Health app.</p><h2 id="overriding-feature-flags"><span class="me-2">Overriding feature flags</span><a href="#overriding-feature-flags" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Another situation when launch arguments can come in handy is working on a new feature that hasn’t been fully shipped yet. Like we took a look at in “Feature flags in Swift”, using feature flags can be a great way to enable features to be gradually rolled out to users, and to perform experiments and A/B testing.</p><p>However, when working on an app that relies heavily on feature flags, it can be a bit time consuming and tricky to get the app into the exact state that’s needed in order to be able to work on a specific feature. To solve that problem, we can introduce launch arguments that let us add local overrides to feature flags that normally get their value dynamically from our server:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>
<span class="kd">func</span> <span class="nf">enableSearchIfNeeded</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">override</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">?</span>
    <span class="k">let</span> <span class="nv">key</span> <span class="o">=</span> <span class="s">"search"</span>

    <span class="c1">// We first  check if the argument was actually passed, before</span>
    <span class="c1">// asking UserDefaults to covert it into a Bool, otherwise, </span>
    <span class="c1">// the dynamic value will never be used.</span>
    <span class="cp">#if DEBUG</span>
    <span class="k">if</span> <span class="n">userDefaults</span><span class="o">.</span><span class="nf">value</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="n">key</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="k">override</span> <span class="o">=</span> <span class="n">userDefaults</span><span class="o">.</span><span class="nf">bool</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="n">key</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="cp">#endif</span>

    <span class="k">if</span> <span class="k">override</span> <span class="p">??</span> <span class="n">featureFlags</span><span class="o">.</span><span class="n">searchEnabled</span> <span class="p">{</span>
        <span class="nf">enableSearch</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>

</pre></table></code></div></div><p>While the above code is specific to the Search feature, we could quite easily generalize it to be applicable to any feature flag, and call it in a shared code path - for example, when we load our values from the server.</p><h2 id="setting-state"><span class="me-2">Setting state</span><a href="#setting-state" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Often when debugging or testing an app, we need to put it into a specific state, in order to either reproduce a bug or to be able to use a certain feature. This is something that is often repetitive (and a bit annoying) to have to do over and over again when working on something - so let’s automate it using launch arguments!</p><p>First up, let’s add an easy way to completely reset our app. This could of course be done by manually uninstalling the app, but it’d be a lot easier to simply pass a <code class="language-plaintext highlighter-rouge">-reset</code> argument when running the app to have it launch in a blank state. To do that, let’s add a <code class="language-plaintext highlighter-rouge">resetIfNeeded()</code> method that we call from our <code class="language-plaintext highlighter-rouge">AppDelegate</code> when the app launches, like this:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre>
<span class="kd">extension</span> <span class="kt">AppDelegate</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">resetIfNeeded</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="kt">CommandLine</span><span class="o">.</span><span class="n">arguments</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"-reset"</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>

        <span class="c1">// We can reset our user defaults by removing the persistance </span>
        <span class="c1">// for our app's bundle identifier</span>
        <span class="k">let</span> <span class="nv">defaultsName</span> <span class="o">=</span> <span class="kt">Bundle</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">bundleIdentifier</span><span class="o">!</span>
        <span class="n">userDefaults</span><span class="o">.</span><span class="nf">removePersistentDomain</span><span class="p">(</span><span class="nv">forName</span><span class="p">:</span> <span class="n">defaultName</span><span class="p">)</span>

        <span class="c1">// Reset any caching mechanisms, databases, etc.</span>
        <span class="n">cache</span><span class="o">.</span><span class="nf">reset</span><span class="p">()</span>
        <span class="n">database</span><span class="o">.</span><span class="nf">reset</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>

</pre></table></code></div></div><p>Similarly, it’s also really convenient to not only be able to reset the app, but also enable it to be put into a specific initial state. Let’s say we’re building an app that contains a list of user contacts. Using a launch argument, we can provide a quick way to pre-populate our contacts database with a given list of names (in this case we use a comma-separated list as our input format):</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>
<span class="kd">extension</span> <span class="kt">ContactsManager</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">addNamesFromCommandLine</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">argument</span> <span class="o">=</span> <span class="n">userDefaults</span><span class="o">.</span><span class="nf">string</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="s">"contacts"</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>

        <span class="k">let</span> <span class="nv">names</span> <span class="o">=</span> <span class="n">argument</span><span class="o">.</span><span class="nf">components</span><span class="p">(</span><span class="nv">separatedBy</span><span class="p">:</span> <span class="s">","</span><span class="p">)</span>
        <span class="n">names</span><span class="o">.</span><span class="nf">forEach</span><span class="p">(</span><span class="n">add</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

</pre></table></code></div></div><h2 id="ui-testing"><span class="me-2">UI testing</span><a href="#ui-testing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Both being able to completely reset our app’s state, and to pre-populated its data, is not only useful for debugging - it also enables us to easily setup a specific state when doing UI testing.</p><p>Like we took a look at in “Getting stated with Xcode UI testing in Swift” and “UI testing analytics code in Swift”, we can add launch arguments to <code class="language-plaintext highlighter-rouge">XCUIApplication</code> that can then be read by our app, providing an (otherwise missing) channel of communication between our tests and our app. Here we use both the <code class="language-plaintext highlighter-rouge">-reset</code> and <code class="language-plaintext highlighter-rouge">-contacts</code> launch arguments to setup an initial state for a test that verifies that we can remove a contact from the contact list:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>
<span class="kd">func</span> <span class="nf">testRemovingContact</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Setup and launch the app</span>
    <span class="k">let</span> <span class="nv">app</span> <span class="o">=</span> <span class="kt">XCUIApplication</span><span class="p">()</span>
    <span class="n">app</span><span class="o">.</span><span class="n">launchArguments</span> <span class="o">=</span> <span class="p">[</span><span class="s">"-reset"</span><span class="p">,</span> <span class="s">"-contacts"</span><span class="p">,</span> <span class="s">"John, Mary"</span><span class="p">]</span>
    <span class="n">app</span><span class="o">.</span><span class="nf">launch</span><span class="p">()</span>

    <span class="c1">// Verify that we initially are displaying 2 contacts</span>
    <span class="kt">XCTestAssertEqual</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1">// Swipe the cell for a given contact and tap the "Remove" button</span>
    <span class="k">let</span> <span class="nv">cell</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="s">"Contact-John"</span><span class="p">]</span>
    <span class="n">cell</span><span class="o">.</span><span class="nf">swipeLeft</span><span class="p">()</span>
    <span class="n">cell</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="s">"Remove"</span><span class="p">]</span><span class="o">.</span><span class="nf">tap</span><span class="p">()</span>

    <span class="c1">// Verify that we no only have 1 contact left</span>
    <span class="kt">XCTAssertEqual</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">}</span>

</pre></table></code></div></div><p>Using the above technique to set a specific initial state for our UI tests is a great way to combat flakiness and to speed up to the overall execution time of our test suite, since we don’t have to always perform a lot of setup in each test and can instead just jump to the feature we want to verify.</p><h2 id="containment"><span class="me-2">Containment</span><a href="#containment" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>One concern when doing all of the above, is how we’ve essentially now scattered a lot of debugging and testing code all over our normal app code.</p><p>While adding code specifically for debugging is not necessarily a bad thing (our code base is kind of our “digital work place”, at all), it would be better if we could contain it all in one place instead of spreading it all over our app. That way we’d be more in control over what debug code we actually have, and it becomes much easier to prevent such code from accidentally making its way into a release build.</p><p>One way to do is that is to move all code related to launch arguments into a dedicated type. As an example, here’s how we could move our actions for resetting, delaying network requests and adding mocked contacts into a single, contained <code class="language-plaintext highlighter-rouge">LaunchArgumentsHandler</code>:</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre><td class="rouge-code"><pre>
<span class="kd">struct</span> <span class="kt">LaunchArgumentsHandler</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">userDefaults</span><span class="p">:</span> <span class="kt">UserDefaults</span>
    <span class="k">let</span> <span class="nv">contactsManager</span><span class="p">:</span> <span class="kt">ContactsManager</span>
    <span class="k">let</span> <span class="nv">dataLoader</span><span class="p">:</span> <span class="kt">DataLoader</span>
    <span class="k">let</span> <span class="nv">cache</span><span class="p">:</span> <span class="kt">Cache</span>
    <span class="k">let</span> <span class="nv">database</span><span class="p">:</span> <span class="kt">Database</span>

    <span class="kd">func</span> <span class="nf">handle</span><span class="p">()</span> <span class="p">{</span>
        <span class="nf">resetIfNeeded</span><span class="p">()</span>
        <span class="nf">addNetworkDelayIfNeeded</span><span class="p">()</span>
        <span class="nf">addContactsIfNeeded</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">resetIfNeeded</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="kt">CommandLine</span><span class="o">.</span><span class="n">arguments</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"-reset"</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>

        <span class="k">let</span> <span class="nv">defaultsName</span> <span class="o">=</span> <span class="kt">Bundle</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">bundleIdentifier</span><span class="o">!</span>
        <span class="n">userDefaults</span><span class="o">.</span><span class="nf">removePersistentDomain</span><span class="p">(</span><span class="nv">forName</span><span class="p">:</span> <span class="n">defaultsName</span><span class="p">)</span>

        <span class="n">cache</span><span class="o">.</span><span class="nf">reset</span><span class="p">()</span>
        <span class="n">database</span><span class="o">.</span><span class="nf">reset</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">addNetworkDelayIfNeeded</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">delay</span> <span class="o">=</span> <span class="n">userDefaults</span><span class="o">.</span><span class="nf">double</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="s">"network-delay"</span><span class="p">)</span>

        <span class="k">guard</span> <span class="n">delay</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>

        <span class="c1">// We've abstracted the delaying of data loader tasks</span>
        <span class="c1">// into an "executor" closure, leaving our production</span>
        <span class="c1">// code free of any delaying code.</span>
        <span class="n">dataLoader</span><span class="o">.</span><span class="n">taskExecutor</span> <span class="o">=</span> <span class="p">{</span> <span class="n">task</span> <span class="k">in</span>
            <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="nf">asyncAfter</span><span class="p">(</span><span class="nv">deadline</span><span class="p">:</span> <span class="o">.</span><span class="nf">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">delay</span><span class="p">,</span>
                                            <span class="nv">execute</span><span class="p">:</span> <span class="n">task</span><span class="o">.</span><span class="n">resume</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">addContactsIfNeeded</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">arguments</span> <span class="o">=</span> <span class="n">userDefaults</span><span class="o">.</span><span class="nf">string</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="s">"contacts"</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>

        <span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="n">argument</span><span class="o">.</span><span class="nf">components</span><span class="p">(</span><span class="nv">separated</span><span class="p">:</span> <span class="s">","</span><span class="p">)</span>
        <span class="n">names</span><span class="o">.</span><span class="nf">forEach</span><span class="p">(</span><span class="n">contactManager</span><span class="o">.</span><span class="n">add</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

</pre></table></code></div></div><p>We can now either surround the above <code class="language-plaintext highlighter-rouge">LaunchArgumentsHandler</code> declaration with the same <code class="language-plaintext highlighter-rouge">#if DEBUG</code> condition as before, or if we’re using separate Xcode targets for our debug/staging builds and release builds - we can simply exclude the <code class="language-plaintext highlighter-rouge">LaunchArgumentsHandler.swift</code> file from our production target.</p><p>By doing that, we now both get a much cleaner overview over what launch argument actions that are available, and we’ll get a compilation error when doing a release build in case we’re accidentally using any debug code where it doesn’t belong.</p><p>All we have to do now is to call <code class="language-plaintext highlighter-rouge">LaunchArgumentsHandler</code> after we’ve set up our app (for example in our <code class="language-plaintext highlighter-rouge">AppDelegate</code>) and surround that call with <code class="language-plaintext highlighter-rouge">#if DEBUG</code> to have it compile correctly under all conditions.</p><h2 id="conclusion"><span class="me-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Launch arguments can provide an easy way to set up really useful debugging and mocking actions that can help speed up our development and testing. By adding launch arguments we can quickly get into a state that we desire, or reset our app completely on each launch, removing the need to manually set these things up every time we run the app.</p><p>While there’s definitely a risk associated with adding these type of debugging actions - since we are introducing more code paths and possible states to our app - keeping the amount of launch arguments low and containing all code dealing with them in a single place really helps mitigating that risks. Like with many things, it becomes a balancing act of risks vs reward, and picking some key launch arguments (and clean up old ones) can definitely make that balance tip in our favor.</p><p>What do you think? Do you use launch arguments to speed up your development and testing, or is it something you’ll try out? Let me know.</p><p>Thanks for reading!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/swift/">Swift</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/scripting/" class="post-tag no-text-decoration" >scripting</a> <a href="/tags/debugging/" class="post-tag no-text-decoration" >debugging</a> <a href="/tags/ui-testing/" class="post-tag no-text-decoration" >ui testing</a> <a href="/tags/swift5-0/" class="post-tag no-text-decoration" >swift5.0</a> <a href="/tags/launch-arguments/" class="post-tag no-text-decoration" >launch arguments</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Launch%20arguments%20in%20Swift%20-%20iCodeX's%20blog&url=%2Fposts%2Flaunch-arguments-swift%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Launch%20arguments%20in%20Swift%20-%20iCodeX's%20blog&u=%2Fposts%2Flaunch-arguments-swift%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fposts%2Flaunch-arguments-swift%2F&text=Launch%20arguments%20in%20Swift%20-%20iCodeX's%20blog" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/conditioning-habits/">Conditioning Habits - The Key to Lasting Change</a><li class="text-truncate lh-lg"> <a href="/posts/cover-6mn-study-in-3days/">Cramming Effectively - How to Cover 6 Months of Study in 72 Hours</a><li class="text-truncate lh-lg"> <a href="/posts/comparison-human-brain-supercomputer/">Human Brain vs. Supercomputer - A Hardware Perspective</a><li class="text-truncate lh-lg"> <a href="/posts/power-detachment/">The Power of Detachment - A Key to Better Decision-Making and Leadership</a><li class="text-truncate lh-lg"> <a href="/posts/how-use-docker-windows-offline/">Building a Docker Environment Completely Offline on Windows 10</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/basics/">basics</a> <a class="post-tag btn btn-outline-primary" href="/tags/llm/">llm</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai/">ai</a> <a class="post-tag btn btn-outline-primary" href="/tags/swiftui/">swiftui</a> <a class="post-tag btn btn-outline-primary" href="/tags/architecture/">architecture</a> <a class="post-tag btn btn-outline-primary" href="/tags/learning/">learning</a> <a class="post-tag btn btn-outline-primary" href="/tags/habits/">habits</a> <a class="post-tag btn btn-outline-primary" href="/tags/strategy/">strategy</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift5-0/">swift5.0</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift5-1/">swift5.1</a></div></section></div><section id="toc-wrapper" class="d-none ps-0 pe-4"><h2 class="panel-heading ps-3 mb-2">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/overview-dsym/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1393966920" data-df="ll" > Mar 4, 2014 </time><h4 class="pt-0 my-2">An overview of dSYM</h4><div class="text-muted"><p>From Apple’s Documentation: https://developer.apple.com/documentation/xcode/building-your-app-to-include-debugging-information When Xcode compiles our source code into machine code, it generat...</p></div></div></a></article><article class="col"> <a href="/posts/shifting-paradigms-in-swift/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1547676120" data-df="ll" > Jan 16, 2019 </time><h4 class="pt-0 my-2">Shifting paradigms in Swift</h4><div class="text-muted"><p>Every year during WWDC, we in the Apple developer community are presented with a whole suite of new tools, APIs and technologies that we can use to further improve our apps along with the systems t...</p></div></div></a></article><article class="col"> <a href="/posts/struct-convenience-init-swift/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1524784020" data-df="ll" > Apr 26, 2018 </time><h4 class="pt-0 my-2">Struct convenience initializers</h4><div class="text-muted"><p>I love to struct my code using extensions in Swift. One big benefit of doing so when it comes to struct initializers, is that defining a convenience initializer doesn’t remove the default one the c...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/struct-convenience-init-swift/" class="btn btn-outline-primary" aria-label="Older" ><p>Struct convenience initializers</p></a> <a href="/posts/swiftui-game-changer/" class="btn btn-outline-primary" aria-label="Newer" ><p>SwiftUI is a game changer</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://twitter.com/icodex-s24">icodex-s24</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.1.0" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/basics/">basics</a> <a class="post-tag btn btn-outline-primary" href="/tags/llm/">llm</a> <a class="post-tag btn btn-outline-primary" href="/tags/ai/">ai</a> <a class="post-tag btn btn-outline-primary" href="/tags/swiftui/">swiftui</a> <a class="post-tag btn btn-outline-primary" href="/tags/architecture/">architecture</a> <a class="post-tag btn btn-outline-primary" href="/tags/learning/">learning</a> <a class="post-tag btn btn-outline-primary" href="/tags/habits/">habits</a> <a class="post-tag btn btn-outline-primary" href="/tags/strategy/">strategy</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift5-0/">swift5.0</a> <a class="post-tag btn btn-outline-primary" href="/tags/swift5-1/">swift5.1</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script src="/assets/lib/simple-jekyll-search/simple-jekyll-search.min.js"></script> <script src="/assets/lib/loading-attribute-polyfill/loading-attribute-polyfill.umd.min.js"></script> <script src="/assets/lib/glightbox/glightbox.min.js"></script> <script src="/assets/lib/clipboard/clipboard.min.js"></script> <script src="/assets/lib/dayjs/dayjs.min.js"></script> <script src="/assets/lib/dayjs/locale/en.js"></script> <script src="/assets/lib/dayjs/plugin/relativeTime.js"></script> <script src="/assets/lib/dayjs/plugin/localizedFormat.js"></script> <script src="/assets/lib/tocbot/tocbot.min.js"></script> <script src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js"></script> <script>SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
